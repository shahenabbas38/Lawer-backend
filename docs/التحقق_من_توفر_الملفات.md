# كيف تعرف إذا المشكلة من الاستضافة (الملف لا يظهر للمستخدم)

## 1) من التطبيق (بعد التعديلات)

- الباك اند يرجّع حقل **`file_available`** مع تفاصيل الاجتهاد:
  - `true` = الملف موجود على السيرفر.
  - `false` = الملف **غير موجود** (مشكلة تخزين/استضافة).

- إذا كان `file_available: false` يظهر للمستخدم في التطبيق رسالة:  
  **"الملف غير متوفر على السيرفر — قد تكون مشكلة تخزين على الاستضافة."**

يعني: إذا شفت هالرسالة للمستخدم، فالمشكلة من الاستضافة/التخزين وليست من التطبيق.

---

## 2) التحقق يدوياً من المتصفح

1. من **Postman** أو من التطبيق اعرف **رابط الملف**:
   - استدعِ: `GET /api/precedents/{id}/file`
   - خذ من الجواب قيمة **`pdf_url`** (مثلاً:  
     `https://lawer-backend-production.up.railway.app/storage/precedents/xxx.pdf`).

2. افتح نفس الرابط **في المتصفح**:
   - إذا فتح الملف أو بدأ التحميل → الملف موجود، والمشكلة ليست من الاستضافة.
   - إذا ظهر **404** أو صفحة خطأ → الملف غير موجود على السيرفر = **مشكلة استضافة/تخزين**.

---

## 3) أسباب شائعة على Railway

| السبب | الحل |
|--------|------|
| **لم يُنفَّذ `php artisan storage:link`** | تنفيذ الأمر مرة واحدة على بيئة الإنتاج (عند الـ deploy أو يدوياً). |
| **تخزين مؤقت (Ephemeral)** | الملفات تُحذف عند إعادة التشغيل/إعادة النشر. استخدم **Volume** في Railway لـ `storage/app/public` أو استخدم تخزين خارجي (مثل S3). |
| **المسار خاطئ** | التأكد أن `file_path` في قاعدة البيانات يطابق المسار الفعلي داخل `storage/app/public` (مثلاً `precedents/اسم_الملف.pdf`). |

---

## 4) فحص من التيرمنال على السيرفر (إن أمكن)

```bash
# هل الرابط الرمزي موجود؟
ls -la public/storage

# هل الملف موجود؟
ls -la storage/app/public/precedents/
```

إذا `public/storage` غير موجود → نفّذ `php artisan storage:link`.  
إذا مجلد `precedents` فاضي أو الملف غير موجود → الملفات إما لم تُرفع أو تم حذفها (تخزين مؤقت).

---

**الخلاصة:** إذا التطبيق يظهر "الملف غير متوفر على السيرفر" أو أنت تفتح `pdf_url` في المتصفح وتلقى 404، فالمشكلة من الاستضافة/التخزين وليست من الفرونت.
